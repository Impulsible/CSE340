<div class="login-container">
  <h1 class="welcome"><%= title %></h1>
  <p>Sign in to view orders, service history, and saved builds.</p>

  <!-- Flash Messages -->
  <% if (flashMessages) { %>
    <% Object.keys(flashMessages).forEach(type => { %>
      <% flashMessages[type].forEach(message => { %>
        <div class="alert alert-<%= type %>">
          <%= message %>
        </div>
      <% }) %>
    <% }) %>
  <% } %>

  <!-- LOGIN FORM WITH HTML5 CLIENT-SIDE VALIDATION -->
  <form action="/account/login" method="post" novalidate>
    
    <!-- Email -->
    <div class="form-group">
      <label for="account_email">Email Address</label>
      <input 
        type="email" 
        id="account_email" 
        name="account_email" 
        required
        placeholder="Enter a valid email address"
        value="<%= typeof account_email !== 'undefined' ? account_email : '' %>"
      >
    </div>

    <!-- Password -->
    <div class="form-group">
      <label for="account_password">Password</label>

      <!-- Requirement reminder (CSE 340 required) -->
      <div class="password-requirements">
        <strong>Password Requirements:</strong>
        <ul>
          <li>At least 12 characters</li>
          <li>At least 1 uppercase letter</li>
          <li>At least 1 number</li>
          <li>At least 1 special character</li>
        </ul>
      </div>

      <input 
        type="password" 
        id="account_password" 
        name="account_password" 
        required
        minlength="12"
        pattern="^(?=.*\\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[^a-zA-Z0-9])(?!.*\\s).{12,}$"
        placeholder="Enter your password"
        title="At least 12 characters, including 1 uppercase letter, 1 number, and 1 special character."
      >
      
      <!-- Password strength indicator -->
      <div class="password-strength"></div>
    </div>

    <button type="submit" class="btn-primary">Sign In</button>
  </form>

  <div class="register-link">
    <p>Don't have an account? <a href="/account/register">Register here</a></p>
  </div>

  <p><a class="btn-secondary" href="/">Back to Home</a></p>
</div>

<!-- ==================== CSS (CLIENT-SIDE VALIDATION SUPPORT) ==================== -->
<style>
  .login-container {
    max-width: 400px;
    margin: 0 auto;
    padding: 20px;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  }

  .welcome {
    text-align: center;
    color: #333;
    margin-bottom: 10px;
  }

  .login-container > p {
    text-align: center;
    color: #666;
    margin-bottom: 25px;
  }

  .form-group {
    margin-bottom: 20px;
  }

  .form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
    color: #333;
  }

  .form-group input {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 16px;
    box-sizing: border-box;
    transition: border-color 0.3s, box-shadow 0.3s;
  }

  /* INVALID INPUT */
  input:required:invalid, input:focus:invalid {
    border-color: #ff4757;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23ff4757' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='10'%3E%3C/circle%3E%3Cline x1='15' y1='9' x2='9' y2='15'%3E%3C/line%3E%3Cline x1='9' y1='9' x2='15' y2='15'%3E%3C/line%3E%3C/svg%3E");
    background-position: right 10px center;
    background-repeat: no-repeat;
    background-size: 16px;
    padding-right: 35px;
  }

  /* VALID INPUT */
  input:required:valid {
    border-color: #2ed573;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%232ed573' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M22 11.08V12a10 10 0 1 1-5.93-9.14'%3E%3C/path%3E%3Cpolyline points='22 4 12 14.01 9 11.01'%3E%3C/polyline%3E%3C/svg%3E");
    background-position: right 10px center;
    background-repeat: no-repeat;
    background-size: 16px;
    padding-right: 35px;
  }

  /* INPUT FOCUS */
  input:focus {
    outline: none;
    border-color: #007bff;
    box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
  }

  /* Password Requirements Box */
  .password-requirements {
    background-color: #f8f9fa;
    padding: 10px 15px;
    border-radius: 4px;
    font-size: 14px;
    margin-top: 8px;
    border-left: 3px solid #007bff;
  }

  .password-strength {
    height: 5px;
    border-radius: 2px;
    margin-top: 5px;
    transition: all 0.3s;
  }

  .strength-weak { background-color: #ff4757; width: 25%; }
  .strength-medium { background-color: #ffa502; width: 50%; }
  .strength-strong { background-color: #2ed573; width: 75%; }
  .strength-very-strong { background-color: #2ed573; width: 100%; }

  .alert { padding: 15px; border-radius: 5px; margin: 10px 0; }
  .alert-success { background: #d4edda; color: #155724; }
  .alert-error { background: #f8d7da; color: #721c24; }
  .alert-notice { background: #d1ecf1; color: #0c5460; }

  .btn-primary {
    background: #007bff;
    color: #fff;
    padding: 12px;
    border: none;
    width: 100%;
    border-radius: 4px;
    cursor: pointer;
    margin-bottom: 15px;
  }

  .register-link {
    text-align: center;
    margin-top: 15px;
  }
</style>

<!-- ==================== JAVASCRIPT (REAL-TIME FEEDBACK) ==================== -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const passwordInput = document.getElementById('account_password');
  const strengthBar = document.querySelector('.password-strength');

  passwordInput.addEventListener('input', () => {
    const value = passwordInput.value;
    let strength = 0;

    if (value.length >= 12) strength++;
    if (/[A-Z]/.test(value)) strength++;
    if (/[0-9]/.test(value)) strength++;
    if (/[^a-zA-Z0-9]/.test(value)) strength++;

    strengthBar.className = 'password-strength';

    if (value.length > 0) {
      if (strength <= 1) strengthBar.classList.add('strength-weak');
      else if (strength == 2) strengthBar.classList.add('strength-medium');
      else if (strength == 3) strengthBar.classList.add('strength-strong');
      else strengthBar.classList.add('strength-very-strong');
    }
  });
});
</script>
